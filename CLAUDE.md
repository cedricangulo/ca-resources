# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

CA Resources is a Next.js 15 documentation site built with Fumadocs for curated web development resources and guides. The site features a **dual content system** (Resources + Guides) with a **client-side favorites system** using localStorage and cross-component synchronization via custom events.

## Build & Development Commands

```bash
bun dev                 # Start dev server with Turbopack
bun run build           # Production build
bun start               # Run production server
bun run lint            # ESLint
bun run format          # Prettier + Tailwind class sorting
bun run clean           # Remove .next and .source directories
bun run postinstall     # Generate .source directory (run after install)
```

**Critical:** After fresh installs or cleaning, always run `bun run postinstall` to generate the `.source` directory that Fumadocs requires.

No test runner is configured in this project.

## High-Level Architecture

### Content System

```
content/{guides|resources}/*.mdx
    ↓
source.config.ts (defineDocs for each collection)
    ↓
.source/index.ts (generated by fumadocs-mdx)
    ↓
lib/source.ts (Fumadocs loaders for guidesSource and resourcesSource)
    ↓
API routes (/api/search) and page layouts
```

**Navigation structure** is defined in `content/*/meta.json` files. Each MDX file can have frontmatter defining slug, title, and metadata.

### Dual Content Collections

- **Guides** (`content/guides/`): Full documentation pages with breadcrumb navigation, code blocks, and nested folder support
- **Resources** (`content/resources/`): Curated external links presented as cards with favorites integration

Both collections are independently managed but share the same search index and navigation system.

### Favorites System

- **Hook**: `useFavorites()` (in `hooks/use-favorites.ts`) manages state, localStorage persistence, and exposes methods: `addFavorite`, `removeFavorite`, `toggleFavorite`, `isFavorite`, `getFavoritesByCategory`, etc.
- **Storage Key**: `ca-resources-favorites` in localStorage
- **Cross-component Sync**: Custom event `favorites-updated` dispatched when favorites change, allowing multiple components to stay in sync
- **ID Generation**: Deterministic from `title + href` to prevent duplicates
- **Data Migration**: `migrateFavoritesData()` in `lib/favorites.ts` handles schema changes

### Client-Side Constraints

- Always check `typeof window !== "undefined"` before accessing browser APIs
- localStorage operations must be wrapped in try/catch blocks
- Components using favorites must be marked with `"use client"` directive

## Code Style & Organization

### Import Order (Auto-sorted by Prettier)

React → Next.js → Internal @/ imports → Relative imports

### Naming Conventions

- **Components**: PascalCase (`CustomCard`, `FavoritesButton`)
- **Hooks**: camelCase with `use` prefix (`useFavorites`)
- **Utilities**: camelCase (`cn`, `generateFavoriteId`)
- **Types**: PascalCase (`FavoriteResource`, `CreateFavoriteInput`)
- **Files**: kebab-case for utilities, PascalCase for components
- **Constants**: UPPER_SNAKE_CASE (`STORAGE_KEY`, `FAVORITES_EVENT`)

### Styling with Tailwind

Use `cn()` utility from `@/lib/utils` to combine classes. **Prettier automatically sorts classes** via `prettier-plugin-tailwindcss` in this order:

1. Base utilities (layout, positioning, sizing)
2. Component utilities (borders, backgrounds, typography)
3. Responsive variants (sm:, md:, lg:, xl:)
4. State variants (hover:, focus:, active:, etc.)
5. Custom/arbitrary values

Only manually group classes when separating complex conditional logic (variant-based or state-based styles). Always place external className prop last.

See `.github/instructions/styling.instructions.md` for detailed examples.

### TypeScript

- Use explicit return types on exported functions
- Prefer interfaces for object shapes, types for unions/complex types
- Use `type` imports for type-only imports: `import type { Favorite } from "@/types"`
- Strict mode is enabled (tsconfig.json)

### Error Handling

- Use try/catch for localStorage operations
- Log errors to console with descriptive context
- Return safe defaults on failure (empty arrays, null values)

```typescript
try {
  const stored = localStorage.getItem(STORAGE_KEY)
  if (!stored) return []
  return JSON.parse(stored)
} catch (error) {
  console.error("Failed to load favorites:", error)
  return []
}
```

## Critical Files

- `lib/source.ts` - Fumadocs loaders for both content sources
- `source.config.ts` - Fumadocs collection definitions
- `hooks/use-favorites.ts` - Complete favorites state management
- `app/layout.config.tsx` - Navigation structure and branding
- `lib/favorites.ts` - Favorite ID generation and data migration
- `components/shared/resources/custom-card.tsx` - Standard resource card component
- `content/guides/meta.json` and `content/resources/meta.json` - Navigation structure

## Common Workflows

### Adding New Resources

1. Create MDX in `content/resources/category-name.mdx` (or update existing file)
2. Update `content/resources/meta.json` to add navigation entry
3. Use `<CustomCard>` component in MDX for external links
4. Resources automatically appear in search and favorites system

### Adding New Guides

1. Create MDX in `content/guides/(category)/page-name.mdx`
2. Update `content/guides/(category)/meta.json` for navigation
3. Guides support full documentation features and nested folders

### Development Notes

- **Search API**: `/api/search/route.ts` combines both content sources
- **External Links**: Include `?ref=ca-resources.vercel.app` query param
- **Image Optimization**: Remote images from `gvmemz92tx.ufs.sh` configured in `next.config.mjs`
- **Theme System**: Fumadocs `RootProvider` with custom CSS variables in `global.css`

## Additional References

See `.github/copilot-instructions.md` for more detailed architecture patterns and component examples. See `AGENTS.md` for additional development guidelines.
